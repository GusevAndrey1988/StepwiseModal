(()=>{"use strict";class t{constructor(t,e){this.name=t,this.options=e,this.modified=!0,this.element=null,this.contentBuffer="",this.templateBuffer="",this.prepareOptions(),this.setupCommonParameters(),this.createElement()}prepareOptions(){this.options.parameters=this.options.parameters||{},this.options.onShow=this.options.onShow||(()=>!0),this.options.onHide=this.options.onHide||(()=>!0)}setupCommonParameters(){this.options.parameters["-modal-name"]=this.name}createElement(){this.element=document.createElement("div"),this.element.dataset.modalName=this.name,this.attachEventHandlers()}attachEventHandlers(){this.element.addEventListener("click",(e=>{e.target.closest(t.CLOSE_BUTTON_SELECTOR)&&this.hide()}).bind(this))}show(){this.options.onShow(this)&&(this.modified&&(this.renderContentToBuffer(),this.renderTemplateToBuffer(this.contentBuffer),this.element.innerHTML=this.templateBuffer,this.options.backplate.attach(this.element)),this.options.backplate.show(),this.modified=!1)}renderContentToBuffer(){this.contentBuffer=this.options.content?this.options.renderer.render(this.options.content,this.options.parameters):""}renderTemplateToBuffer(t){this.templateBuffer=this.options.renderer.render(this.options.template,Object.assign(Object.assign({},this.options.parameters),{content:t}))}hide(){this.options.onHide(this)&&this.options.backplate.hide()}changeParameters(t){this.options.parameters=t,this.setupCommonParameters(),this.modified=!0}combineParameters(t){this.options.parameters=Object.assign(Object.assign({},this.options.parameters),t),this.setupCommonParameters(),this.modified=!0}}t.CLOSE_BUTTON_SELECTOR="[data-modal-close]";const e=t;class s{constructor(t){this.template=t}getTemplate(){return this.template}}class i{constructor(t,e,s,i={}){this.stepName=t,this.assignedVisibleEntity=e,this.parent=s,this.options=i,this.links=new Map,this.prepareOptions()}prepareOptions(){this.options.onEnter=this.options.onEnter||(()=>{}),this.options.onLeave=this.options.onLeave||(()=>{}),this.options.onShow=this.options.onShow||(()=>{}),this.options.onHide=this.options.onHide||(()=>{})}enter(){this.options.onEnter(this,this.parent)}leave(){this.options.onLeave(this,this.parent)}show(){this.assignedVisibleEntity.show(),this.options.onShow(this,this.parent)}hide(){this.assignedVisibleEntity.hide(),this.options.onHide(this,this.parent)}next(t=null){for(let e of this.links.entries())if(e[1].rule(this,this.parent,t))return e[1].step}name(){return this.stepName}assignedVisible(){return this.assignedVisibleEntity}link(t,e,s=null){let i=s;i||(i=t.name()),this.links.set(i,{rule:e,step:t})}}window.Widgets=window.Widgets||{},window.Widgets.Modal=window.Widgets.Modal||{},window.Widgets.Modal.Backplate=class{constructor(t={}){this.options=t,this.element=null,this.prepareOptions(),this.element=document.createElement("div"),this.element.classList.add(...this.options.classNames),this.setBackplateStyles(this.element),this.bindEventHandlers(),document.body.append(this.element)}prepareOptions(){this.options.color||(this.options.color="#00000088"),this.options.classNames||(this.options.classNames=["modals-backplate"]),this.options.onClick=this.options.onClick||(()=>{})}setBackplateStyles(t){t.style.cssText=`\n            position: fixed;\n            top: 0;\n            bottom: 0;\n            right: 0;\n            left: 0;\n            display: none;\n            background-color: ${this.options.color};\n        `}bindEventHandlers(){this.element.addEventListener("click",(t=>{this.options.onClick(this,t)}).bind(this))}attach(t){this.element.innerHTML="",this.element.append(t)}show(){this.element.style.display="block"}hide(){this.element.style.display="none"}},window.Widgets.Modal.Template=s,window.Widgets.Modal.TemplateRenderer=class{constructor(){}render(t,e){return t.getTemplate().replace(/\{\{(?<property>.+)\}\}/g,((t,s)=>s in e?e[s]:""))}},window.Widgets.Modal.Modal=e,window.Widgets.Modal.StepwiseModal=class{constructor(t,e={}){this.name=t,this.options=e,this.currentStep=null,this.steps=new Map,this.prepareOptions(),this.bindEvents()}prepareOptions(){void 0===this.options.useDataAttribute&&(this.options.useDataAttribute=!1)}bindEvents(){this.options.useDataAttribute&&document.body.addEventListener("click",(t=>{const e=t.target.closest(`[data-next-for="${this.name}"]`);if(!e)return;let s=null;e.hasAttribute("data-user-object")&&(s=e.getAttribute("data-user-object")),this.nextStep(s)}).bind(this))}createStep(t,e,s={}){let n=new i(t,e,this,s);return this.steps.set(t,n),this.currentStep||this.setCurrentStep(t),n}nextStep(t=null){this.currentStep&&(this.currentStep.leave(),this.currentStep.hide(),this.currentStep=this.currentStep.next(t),this.currentStep&&(this.currentStep.enter(),this.currentStep.show()))}setCurrentStep(t){for(let e of this.steps.entries())return e[0]===t&&(this.currentStep=e[1],this.currentStep.enter()),!0;return!1}show(){this.currentStep&&this.currentStep.assignedVisible().show()}hide(){this.currentStep&&this.currentStep.assignedVisible().hide()}},window.Widgets.Modal.SimpleTemplate=new s('\n    <div class="simple-modal-template">\n        <div class="simple-modal-template-header">\n            <div class="simple-modal-template-title">{{title}}</div>\n            <div class="simple-modal-template-close-btn" data-modal-close="">\n                <span></span>\n                <span></span>\n            </div>\n        </div>\n        <div class="simple-modal-template-content">\n            {{content}}\n        </div>\n        <div class="simple-modal-template-footer">\n            {{footer-content}}\n        </div>\n    </div>\n')})();